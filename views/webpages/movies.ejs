<!doctype html>
<html lang="zxx">

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>
		<%= title %>
	</title>

	<link rel="stylesheet" href="/assets/css/style-starter.css" />
	<link rel="shortcut icon" href="/images-removebg-preview (2).png" />
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
	<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" rel="stylesheet" />

	<style>
		body {
			background-color: #a3b4b5;
			padding: 0;
			margin: 0;
			font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
		}

		/* Filters Section */
		h1.mb-3 {
			color: #1a1f1e;
			font-weight: 700;
			border-bottom: 2px solid #445a5b;
			padding-bottom: 10px;
			margin-bottom: 25px;
		}

		.filter-btn {
			border-radius: 50px !important;
			margin: 5px 7px 10px 0;
			padding: 8px 18px;
			font-weight: 600;
			transition: all 0.3s ease;
			border-width: 2px !important;
		}

		.filter-btn:hover {
			background-color: #43625c !important;
			color: white !important;
			transform: scale(1.05);
		}

		.filter-btn.active {
			background-color: #476d63 !important;
			color: white !important;
			box-shadow: 0 4px 12px rgba(93, 112, 112, 0.4);
		}

		/* Selected Filter Tags */
		.selected-filter-tag {
			background-color: #83aa9d;
			color: white;
			padding: 7px 15px;
			border-radius: 30px;
			font-weight: 600;
			box-shadow: 0 2px 6px rgba(220, 53, 69, 0.35);
			margin-right: 10px;
			margin-bottom: 10px;
			display: inline-flex;
			align-items: center;
			cursor: default;
		}

		.selected-filter-tag i {
			cursor: pointer;
			margin-left: 8px;
			font-size: 14px;
			transition: color 0.3s ease;
		}

		.selected-filter-tag i:hover {
			color: #ffc9cc;
		}

		/* Movie Cards */
		#movie-container .card {
			border-radius: 12px;
			box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
			transition: transform 0.3s ease, box-shadow 0.3s ease;
			cursor: pointer;
			background-color: white;
		}

		#movie-container .card:hover {
			transform: translateY(-8px);
			box-shadow: 0 15px 25px rgba(220, 53, 69, 0.3);
		}

		#movie-container .card-img-top {
			height: 220px;
			object-fit: cover;
			border-top-left-radius: 12px;
			border-top-right-radius: 12px;
		}

		#movie-container .card-body {
			padding: 15px 18px;
		}

		#movie-container .card-title {
			font-size: 1.15rem;
			font-weight: 700;
			margin-bottom: 8px;
			color: #333;
		}

		#movie-container .card-text {
			font-size: 0.9rem;
			color: #555;
			margin-bottom: 8px;
		}

		#movie-container .btn-primary {
			background-color: #417078;
			border: none;
			font-weight: 600;
			padding: 8px 16px;
			border-radius: 30px;
			transition: background-color 0.3s ease;
			width: 100%;
		}

		#movie-container .btn-primary:hover {
			background-color: #b02a37;
		}

		/* Accordion Button Colors */
		.accordion-button {
			font-weight: 600;
			color: #202726;
			background-color: #5a6f6f;
			border-radius: 8px;
			margin-bottom: 12px;
			border: none;
			box-shadow: none;
			transition: background-color 0.3s ease;
		}

		.accordion-button:not(.collapsed) {
			background-color: #69928c;
			color: white;
			box-shadow: 0 4px 10px rgba(220, 53, 69, 0.3);
		}

		.accordion-button:hover {
			background-color: #c82333;
			color: white;
		}

		.accordion-body {
			padding-left: 10px;
			padding-top: 10px;
		}
	</style>
	<!-- SweetAlert2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body>
	<!-- Header -->
	<header id="site-header" class="w3l-header fixed-top">
		<%- include("../layout/user_layout/navbar.ejs") %>
	</header>

	<!-- Page Content -->
	<section>
		<div class="container" style="margin-top: 120px; margin-bottom: 50px;">
			<div class="row gx-5">
				<!-- Filter Section -->
				<div class="col-md-4">
					<h1 class="mb-3">Filters</h1>
					<div class="accordion" id="accordionExample">
						<!-- Date Filter -->
						<div class="accordion-item">
							<h2 class="accordion-header" id="headingOne">
								<button class="accordion-button" type="button" data-bs-toggle="collapse"
									data-bs-target="#collapseOne">
									Date
								</button>
							</h2>
							<div id="collapseOne" class="accordion-collapse collapse show"
								data-bs-parent="#accordionExample">
								<div class="accordion-body">
									<button class="btn btn-outline-danger filter-btn" data-type="date"
										data-value="today">Today</button>
									<button class="btn btn-outline-danger filter-btn" data-type="date"
										data-value="tomorrow">Tomorrow</button>
									<button class="btn btn-outline-danger filter-btn" data-type="date"
										data-value="weekend">This Weekend</button>
								</div>
							</div>
						</div>

						<!-- Language Filter -->
						<div class="accordion-item">
							<h2 class="accordion-header" id="headingTwo">
								<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
									data-bs-target="#collapseTwo">
									Languages
								</button>
							</h2>
							<div id="collapseTwo" class="accordion-collapse collapse"
								data-bs-parent="#accordionExample">
								<div class="accordion-body">
									<button class="btn btn-outline-danger filter-btn" data-type="language"
										data-value="English">English</button>
									<button class="btn btn-outline-danger filter-btn" data-type="language"
										data-value="Hindi">Hindi</button>
									<button class="btn btn-outline-danger filter-btn" data-type="language"
										data-value="Bengali">Bengali</button>
									<button class="btn btn-outline-danger filter-btn" data-type="language"
										data-value="Telugu">Telugu</button>
									<button class="btn btn-outline-danger filter-btn" data-type="language"
										data-value="Tamil">Tamil</button>
									<button class="btn btn-outline-danger filter-btn" data-type="language"
										data-value="Malayalam">Malayalam</button>
									<button class="btn btn-outline-danger filter-btn" data-type="language"
										data-value="Kannada">Kannada</button>
								</div>
							</div>
						</div>

						<!-- Genre Filter -->
						<div class="accordion-item">
							<h2 class="accordion-header" id="headingThree">
								<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
									data-bs-target="#collapseThree">
									Genres
								</button>
							</h2>
							<div id="collapseThree" class="accordion-collapse collapse"
								data-bs-parent="#accordionExample">
								<div class="accordion-body">
									<button class="btn btn-outline-danger filter-btn" data-type="genre" data-value="Action">Action</button>
									<button class="btn btn-outline-danger filter-btn" data-type="genre" data-value="Drama">Drama</button>
									<button class="btn btn-outline-danger filter-btn" data-type="genre" data-value="Comedy">Comedy</button>
									<button class="btn btn-outline-danger filter-btn" data-type="genre" data-value="Horror">Horror</button>
									<button class="btn btn-outline-danger filter-btn" data-type="genre" data-value="Thriller">Thriller</button>
									<button class="btn btn-outline-danger filter-btn" data-type="genre" data-value="Romance">Romance</button>
									<button class="btn btn-outline-danger filter-btn" data-type="genre" data-value="Adventure">Adventure</button>
									<button class="btn btn-outline-danger filter-btn" data-type="genre" data-value="Fantasy">Fantasy</button>
									<button class="btn btn-outline-danger filter-btn" data-type="genre" data-value="Sci-Fi">Sci-Fi</button>
									<button class="btn btn-outline-danger filter-btn" data-type="genre" data-value="Biography">Biography</button>
								</div>
							</div>
						</div>

						<!-- Format Filter -->
						<!-- <div class="accordion-item">
							<h2 class="accordion-header" id="headingFour">
								<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
									data-bs-target="#collapseFour">
									Format
								</button>
							</h2>
							<div id="collapseFour" class="accordion-collapse collapse"
								data-bs-parent="#accordionExample">
								<div class="accordion-body">
									 <button class="btn btn-outline-danger filter-btn" data-type="format" data-value="2D">2D</button>
									<button class="btn btn-outline-danger filter-btn" data-type="format" data-value="3D">3D</button>
									<button class="btn btn-outline-danger filter-btn" data-type="format" data-value="IMAX 2D">IMAX 2D</button>
									<button class="btn btn-outline-danger filter-btn" data-type="format" data-value="IMAX 3D">IMAX 3D</button>
									<button class="btn btn-outline-danger filter-btn" data-type="format" data-value="4DX">4DX</button>
									<button class="btn btn-outline-danger filter-btn" data-type="format" data-value="Dolby Atmos">Dolby Atmos</button>
									<button class="btn btn-outline-danger filter-btn" data-type="format" data-value="Dolby Cinema">Dolby Cinema</button>
									<button class="btn btn-outline-danger filter-btn" data-type="format" data-value="ScreenX">ScreenX</button>
									<button class="btn btn-outline-danger filter-btn" data-type="format" data-value="MX4D">MX4D</button>
									<button class="btn btn-outline-danger filter-btn" data-type="format" data-value="D-BOX">D-BOX</button>
									<button class="btn btn-outline-danger filter-btn" data-type="format" data-value="Subtitled">Subtitled</button>
								</div>
							</div> -->
						<!-- </div> -->
					</div>
				</div>

				<!-- Movie Display Section -->
				<div class="col-md-8">
					<h1 class="mb-1 fw-bold" style="color: #2c3231;">Movies</h1>

					<!-- Selected Filters Display -->
					<div id="selected-filters" class="mb-3 d-flex flex-wrap"></div>

					<div id="movie-container" class="row g-4 mt-2">
						<% if (movies && movies.length> 0) { %>
							<% movies.forEach((data)=> { %>
								<div class="col-6 col-md-4 col-lg-4">
									<div class="card h-100">
										<img src="/images/<%= data.posters[0]%>"
											class="card-img-top" alt="<%= data.name %>" />
										<div class="card-body d-flex flex-column">
											<a href="/single-event/<%=data._id%>" class="text-decoration-none text-dark">
												<h5 class="card-title">
													<%= data.name %>
												</h5>
											</a>
											<p class="card-text mb-1">
												<%= data.movieCertificate %>
											</p>
											<p class="card-text mb-3 text-muted">
												<% data.languages.forEach((lang, i)=> { %>
													<%= lang %>
														<%= i < data.languages.length - 1 ? ", " : "" %>
															<% }) %>
											</p>
											<a href="/single-event/<%=data._id%>" class="btn btn-primary mt-auto">Book Now</a>
										</div>
									</div>
								</div>
								<% }) %>
									<% } else { %>
										<div class="col-12">
											<p>No movies found.</p>
										</div>
										<% } %>
					</div>
				</div>
			</div>
		</div>
	</section>

	<!-- Footer -->
	<%- include("../layout/user_layout/footer.ejs") %>

		<!-- JS Scripts -->
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
		<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	 <!-- Scripts -->
<!-- jQuery (CDN) -->
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<!-- Bootstrap (CDN) -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>


		<!-- Filter Script -->
		<script>
			$(document).ready(function () {
				// Filters object holds arrays for multi-select filters, except date which is a single value (string or null)
				const filters = {
					date: null,      // single select: store one value or null if none selected
					language: [],
					genre: [],
					format: []
				};

				function updateQuery() {
					const params = new URLSearchParams();

					// For date (single select)
					if (filters.date) {
						params.append('date', filters.date);
					}

					// For multi-select filters
					['language', 'genre', 'format'].forEach(type => {
						filters[type].forEach(value => params.append(type, value));
					});

					const query = params.toString();
					history.pushState({}, '', `?${query}`);

					$.get(`/movies?${query}`, function (html) {
						const newDOM = $('<div>').html(html);
						$('#movie-container').html(newDOM.find('#movie-container').html());
					});

					renderSelectedFilters();
					highlightActiveButtons();
				}

				function renderSelectedFilters() {
					const container = $('#selected-filters');
					container.html('');

					// Date (single select)
					if (filters.date) {
						const tag = $(`
				<span class="badge bg-danger selected-filter-tag">
				Date: ${filters.date}
				<i class="fas fa-times remove-filter" data-type="date" data-value="${filters.date}"></i>
				</span>
			`);
								container.append(tag);
					}

					// Multi-select filters
					['language', 'genre', 'format'].forEach(type => {
						filters[type].forEach(value => {
							const tag = $(`
          <span class="badge bg-danger selected-filter-tag">
            ${type.charAt(0).toUpperCase() + type.slice(1)}: ${value}
            <i class="fas fa-times remove-filter" data-type="${type}" data-value="${value}"></i>
          </span>
        `);
							container.append(tag);
						});
					});
				}

				function highlightActiveButtons() {
					$('.filter-btn').removeClass('active');

					// Highlight date button if selected
					if (filters.date) {
						$(`.filter-btn[data-type="date"][data-value="${filters.date}"]`).addClass('active');
					}

					// Highlight multi-select buttons
					['language', 'genre', 'format'].forEach(type => {
						filters[type].forEach(value => {
							$(`.filter-btn[data-type="${type}"][data-value="${value}"]`).addClass('active');
						});
					});
				}

				$('.filter-btn').on('click', function () {
					const type = $(this).data('type');
					const value = $(this).data('value');

					if (type === 'date') {
						// Single select: toggle date filter
						if (filters.date === value) {
							filters.date = null;  // deselect if clicked again
						} else {
							filters.date = value; // select new date (only one)
						}
					} else {
						// Multi-select filters
						if (!filters[type]) {
							filters[type] = [];
						}
						const index = filters[type].indexOf(value);
						if (index > -1) {
							filters[type].splice(index, 1);
						} else {
							filters[type].push(value);
						}
					}

					updateQuery();
				});

				$('#selected-filters').on('click', '.remove-filter', function () {
					const type = $(this).data('type');
					const value = $(this).data('value');
					if (!filters[type]) return;

					if (type === 'date') {
						filters.date = null;
					} else {
						const index = filters[type].indexOf(value);
						if (index > -1) {
							filters[type].splice(index, 1);
						}
					}

					updateQuery();
				});

				// Initialize arrays if missing (for multi-select filters)
				['language', 'genre', 'format'].forEach(type => {
					if (!filters[type]) filters[type] = [];
				});
			});
		</script>

</body>

</html>